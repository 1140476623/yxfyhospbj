<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>后台管理系统</title>
<link th:href="@{/layui/css/layui.css}" rel="stylesheet" type="text/css">
<script th:src="@{/js/jquery-1.8.2.min.js}" type="text/javascript"></script>
<script th:src="@{/js/common.js}" type="text/javascript"></script>
<script th:src="@{/layui/layui.js}" type="text/javascript"></script>
<link rel="stylesheet" th:href="@{/font-awesome/css/font-awesome.min.css}">
<style>
    .auth {
        border: 1px solid rgb(200, 200, 200);
        position: absolute;
        top: 32%;
        left: 32%;
        width: 400px;
        display: none;
        background: white;
        z-index: 50;
    }
    .layui-form-select{width:182px;}

    .layui-table-cell{
        height:30px !important;

    }
    .layui-tab-content,.layui-table-view {
        padding: 0px;
        margin: 0px;
    }
    .laytable-cell-1-0-3 {
        width: 240px;
        height:auto;
    }
    /*.layui-table-col-special {*/
    /*    height:50px;*/
    /*}*/
    .layui-table thead tr,.layui-table-header
    {
        color: #fff;
        background-color: #5EA3E6;


    }

    .laytable-cell-1-goPhoto{  /*最后的pic为字段的field*/
        height: 100%;
        width: 100%;

    }

    .layui-table tbody{
        height: 50px;
    }
    .layui-table-cell{
        text-align:center;
        height: 50px ;

    }
    </style>
</head>
<body class="layui-layout-body">
<div class="layui-layout layui-layout-admin">
	<div th:replace="~{header :: copy}"></div>
	<div th:replace="~{left :: leftpage}"></div>

<div class="layui-body">
    <!-- 内容主体区域 -->
    <div style="padding: 15px;">
        <fieldset class="layui-elem-field site-demo-button" style="margin-top: 5px;height: 70px;">
    	<div id="demoTable" class="layui-field-box" style="padding-top: 17px">
  			搜索用户名：
  		<div class="layui-inline">
    		<input class="layui-input" name="id" id="demoReload" autocomplete="off">
  		</div>
  			<button class="layui-btn" data-type="reload"><i class="layui-icon layui-icon-search" style="font-size: 15px; "></i>搜索</button>
    		 <button class="layui-btn" id="layerRole" style="float: right " ><i class="layui-icon layui-icon-add-circle" style="font-size: 15px;"></i>人员添加</button>
		</div>
        </fieldset>
   		<table class="layui-hide" id="test" lay-filter="test"></table> 
   		<div id="test1"></div>
   		
   	<!--增加-->
    <div id="autn" class="col-md-7 auth layui-form">
        <form action="" method="post" enctype="multipart/form-data">
            <div class="layui-card">
                <div class="layui-card-header">添加用户</div>
                <div class="layui-card-body">
                    <div class="layui-input-inline">
                        <label class="layui-form-label">账号</label>
                        <div class="layui-input-block">
                            <input name="aadName" id="aadName" placeholder="账号/工号" onkeyup="value=value.replace(/[\u4E00-\u9FA5]/g,'')" class="layui-input" type="text"
                                   required style="margin-bottom : 10px">
                        </div>
                    </div>

                    <div class="layui-input-inline">
                        <label class="layui-form-label">密码</label>
                        <div class="layui-input-block">
                            <input name="adPassword" id="adPassword" placeholder="密码" class="layui-input" type="password" required style="margin-bottom : 10px">
                        </div>
                    </div>

                    <div class="layui-input-inline">
                        <label class="layui-form-label">姓名</label>
                        <div class="layui-input-block">
                            <input name="Name" id="Name" placeholder="姓名" class="layui-input" type="text"
                                   required style="margin-bottom : 10px">
                        </div>
                    </div>
                    <br>

                    <div class="layui-input-inline">
                        <label class="layui-form-label">角色</label>
                         <div class="layui-input-block" style="margin-bottom : 10px">
                            <select name="rId" id="rId" lay-filter="role" class="layui-select"  style="width: 170px">
                                <option value="">--请选择--</option>
                               
                            </select>
                        </div>
                    </div>

                    <!--<div class="layui-input-inline">-->
                        <!--<label class="layui-form-label">区域等级</label>-->
                        <!--<div class="layui-input-block" style="margin-bottom : 10px">-->
                            <!--<select name="regionLevel" id="regionLevel" lay-filter="regionLevel" class="layui-select"  style="width: 170px">-->
                                <!--<option value="">&#45;&#45;请选择&#45;&#45;</option>-->
                                <!--<option value="1">省、直辖市</option>-->
                                <!--<option value="2">地级市、地区</option>-->
                                <!--<option value="3">县、区</option>-->
                                <!--<option value="4">医院、机构</option>-->
                            <!--</select>-->
                        <!--</div>-->
                    <!--</div>-->

                    <!--<div class="layui-input-inline">-->
                        <!--<label class="layui-form-label">区域</label>-->
                        <!--<div class="layui-input-block" style="margin-bottom : 10px">-->
                            <!--<select name="regionId" id="regionId" lay-filter="regionId" class="layui-select"  style="width: 170px">-->
                                <!--<option value="">&#45;&#45;请选择&#45;&#45;</option>-->
                            <!--</select>-->
                        <!--</div>-->
                    <!--</div>-->
                   <!---->
                   

                </div>
            </div>
            <div style="text-align: center">
                <input type="submit" lay-submit="" class="layui-btn" value="添加" lay-filter="addAdmin">
                <button type="button" class="layui-btn layui-btn-danger" onclick="closea()"> 取消</button>
            </div>
            <br>
        </form>
    </div>
    </div>
  </div>
  
   
 </div>
<input type="hidden" th:value="${pagelogo}" id="iden">
<script type="text/html" id="barDemo">
  <a class="layui-btn layui-btn-danger layui-btn-xs" lay-event="delete">删除</a>
</script>
<script type="text/html" id="zizeng">
    {{d.LAY_TABLE_INDEX+1}}
</script>

<script type="text/html" id="caStickModel">
	<div>
		<input type="checkbox" value={{d.status}} lay-skin="switch" lay-filter="switchTest" lay-text="启用|禁用"  {{ d.status =='1' ? 'checked' : '' }} >
	</div>
</script>
<script>

var iden=$("#iden").val();
console.log(iden);
showthis(iden);

layui.use(['laytpl','laypage','table','element','layer','jquery','form'], function(){
	var table = layui.table,
	  element = layui.element,
	  $ = layui.jquery,
	  form=layui.form,
	  layer=layui.layer,
	laytpl = layui.laytpl;
  table.render({
	 id:'testReload' 
    ,elem: '#test'
    ,url:'[[@{/admin/adminList}]]'
    ,title: '用户数据表'
      ,skin:'nob'
    ,cols: [
    	[
       {field:'zizeng',type:'numbers',fixed:'left',title:'序号',style:'height:80px;'}
      ,{field:'id', title:'id',hide:'true'}
      ,{field:'adName', title:'用户名'}
      ,{field:'roleName', title:'角色',style:'height:80px;'}
      ,{field:'rId', title:'rId',hide:"true"}
      ,{field:'regionId', title:'所属区域'}
      ,{fixed: 'right', title:'操作', toolbar: '#barDemo', width:150}
        ]
      ]
   ,page: true
  
  });
  
 
  //监听分页
  $.get('[[@{/admin/getRoleselect}]]',{}, function (data) {
      var $html = "";
      if(data.data != null){
          $.each(data.data, function (index, item) {
          	
              if (item.proType){
                  $html += "<option class='generate' value='" + item.id + "'>" + item.roleName + "</option>";
              }else{
                  $html += "<option value='" + item.id + "'>" + item.roleName + "</option>";
              }
          });

       $("select[name='rId']").append($html);
       
       //反选
       //$("select[name='interest']").val($("#???").val());
       //append后必须从新渲染
       form.render('select');
   }
});


    $.get('[[@{/sysRegion/getParentRegion}]]', function (data) {
        var $html = "";
        if(data.data != null){
            $.each(data.data, function (index, item) {

                if (item.proType){
                    $html += "<option class='generate' value='" + item.id + "'>" + item.regionName + "</option>";
                }else{
                    $html += "<option value='" + item.id + "'>" + item.regionName + "</option>";
                }
            });
            $("select[id='regionId']").append($html);
            //反选
            //$("select[name='interest']").val($("#???").val());
            //append后必须从新渲染
            form.render('select');
        }
    });
  
  
  var active = {
		    reload: function(){
		      var demoReload = $('#demoReload');
		      
		      //执行重载
		      table.reload('testReload', {
		        page: {
		          curr: 1 //重新从第 1 页开始
		        }
		        ,where: {
		            adName: demoReload.val()
		          
		        }
		      });
		    }
		  };  
		  
		  $('#demoTable .layui-btn').on('click', function(){
		    var type = $(this).data('type');
		    active[type] ? active[type].call(this) : '';
		  });


    form.on('select(regionLevel)', function (data) {
        var pid = data.value;
        $('#regionId').html("");
        $.get('[[@{/sysRegion/getParentRegions}]]',{pid:pid}, function (data) {
            var $html = "";
            if(data.data != null){
                $.each(data.data, function (index, item) {

                    if (item.proType){
                        $html += "<option class='generate' value='" + item.id + "'>" + item.regionName + "</option>";
                    }else{
                        $html += "<option value='" + item.id + "'>" + item.regionName + "</option>";
                    }
                });
                $("select[name='regionId']").append($html);
                //反选
                //$("select[name='interest']").val($("#???").val());
                //append后必须从新渲染
                form.render('select');
            }
        });
    });
  
 

 
  
  
  //监听行工具事件
  table.on('tool(test)', function(obj){
    var data = obj.data;
   	var aid=data['id'];
  
    if(obj.event == 'delete'){
      layer.confirm('真的删除行么',{btn: ['确定', '取消'],title:"提示"},function(index){
    
        $.ajax({  
            type: 'post',  
            url: '[[@{/admin/delAdmin}]]', // ajax请求路径  
            data: {  
            	id:aid
            },  
            dataType:'json',
            async:false,
            success: function(data){ 
              if(data.state==1){
            	  layer.msg('删除成功',{
                      time:1000,
                      end:function () {
                      	location.reload();
                      }
                  })
              }else {
                return layer.msg(data.message);
              }
            }  
        }); 
        layer.close(index);
      });
    } 
    
   
    
  });
  
//监听提交
 
  
  form.on('submit(addAdmin)', function(data){
	  $.ajax({  
		    type: 'post',  
		    url: '[[@{/admin/addAdmin}]]', // ajax请求路径  
		    data: {  
		    	adName: data.field.aadName,
		    	adPassword: data.field.adPassword,
		    	rId: data.field.rId,
                Name:data.field.Name,
                regionId:data.field.regionId,
                regionLevel:data.field.regionLevel
		    },  
		    dataType:'json',
		    async:false,
		    success: function(data){ 
		      if(data.state==1){
		      	layer.msg(data.message,{
		              time:2000,
		              end:function () {
		              	location.reload();
		              }
		          })
		          return false;
		      }else {
		      	layer.msg(data.message);
		          return false;
		      }
		    }  
		});

		return false;
  });
  
$(document).on('click','#layerRole',function(){
	  $('#autn').css('display', 'block');
});



});
//关闭提示
function closea() {
    $('#autn').css('display', 'none');
    $('#device').css('display', 'none');
    $('#edit').css('display', 'none');
}
</script>

</body>

</html>